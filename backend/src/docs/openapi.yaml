openapi: 3.0.1
info:
  title: HealTek Auth API
  version: 1.0.0
  description: Authentication API (JWT access + refresh)
servers:
  - url: http://localhost:8080
# ======== ADD TAGS SECTION HERE ========
tags:
  - name: Authentication
    description: User authentication and token management
  - name: User Profile
    description: Current user profile management
  - name: Admin
    description: Administrator-only endpoints
  - name: Health
    description: API health and version information
  - name: Password Reset
    description: Password recovery endpoints (if you add them later)
# ======================================
security:
  - bearerAuth: []
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        name:
          type: string
        role:
          type: string
    Tokens:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
    Error:
      type: object
      properties:
        message:
          type: string
    BaseProfile:
      type: object
      properties:
        name:
          type: string
        username:
          type: string
        profilePhoto:
          type: string
        location:
          type: string
        bio:
          type: string
    ProfessionalInfo:
      type: object
      properties:
        summary:
          type: string
    RoleRequest:
      type: object
      properties:
        name:
          type: string
          enum: [THERAPIST, FITNESS, NUTRITIONIST]
        status:
          type: string
          enum: [PENDING, APPROVED, REJECTED]
        requestedAt:
          type: string
          format: date-time
        approvedAt:
          type: string
          format: date-time
        approvedBy:
          type: string
    Profile:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        baseProfile:
          $ref: '#/components/schemas/BaseProfile'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/RoleRequest'
        activeRole:
          type: string
          enum: [USER, THERAPIST, FITNESS, NUTRITIONIST]
        professionalInfo:
          $ref: '#/components/schemas/ProfessionalInfo'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
                name:
                  type: string
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  tokens:
                    $ref: '#/components/schemas/Tokens'
        '400':
          $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  tokens:
                    $ref: '#/components/schemas/Tokens'
        '401':
          $ref: '#/components/schemas/Error'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Rotate refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Tokens rotated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tokens'
        '401':
          $ref: '#/components/schemas/Error'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout (revoke refresh token)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
      responses:
        '204':
          description: No Content

  /auth/forgot-password:
    post:
      # ======== PASSWORD RESET ENDPOINTS (ADD WHEN READY) ========
      tags:
        - Password Reset
      summary: Request password reset email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
      responses:
        '200':
          description: If email exists, reset instructions sent
        '429':
          description: Too many requests

  /auth/reset-password:
    post:
      tags:
        - Password Reset
      summary: Reset password using token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                newPassword:
                  type: string
                confirmPassword:
                  type: string
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid or expired token
      # ==========================================================

  /me:
    get:
      tags:
        - User Profile
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/schemas/Error'

    put:
      tags:
        - User Profile
      summary: Update current user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Updated user

  /profile/roles/request:
    post:
      tags:
        - User Profile
      summary: Request a professional role
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [THERAPIST, FITNESS, NUTRITIONIST]
      responses:
        '200':
          description: Role request submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    $ref: '#/components/schemas/Profile'
        '400':
          $ref: '#/components/schemas/Error'

  /profile/roles/switch:
    post:
      tags:
        - User Profile
      summary: Switch active role
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [USER, THERAPIST, FITNESS, NUTRITIONIST]
      responses:
        '200':
          description: Active role switched
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    $ref: '#/components/schemas/Profile'
        '400':
          $ref: '#/components/schemas/Error'

  /profile/admin/roles/pending:
    get:
      tags:
        - Admin
      summary: Get pending role requests (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of pending role requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoleRequest'
        '401':
          $ref: '#/components/schemas/Error'
        '403':
          $ref: '#/components/schemas/Error'

  /profile/admin/roles/{profileId}/approve:
    post:
      tags:
        - Admin
      summary: Approve a role request (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [THERAPIST, FITNESS, NUTRITIONIST]
      responses:
        '200':
          description: Role request approved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    $ref: '#/components/schemas/Profile'
        '400':
          $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/schemas/Error'
        '403':
          $ref: '#/components/schemas/Error'

  /profile/admin/roles/{profileId}/reject:
    post:
      tags:
        - Admin
      summary: Reject a role request (admin)
      security:
        - bearerAuth: []
      parameters:
        - name: profileId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [THERAPIST, FITNESS, NUTRITIONIST]
      responses:
        '200':
          description: Role request rejected
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  profile:
                    $ref: '#/components/schemas/Profile'
        '400':
          $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/schemas/Error'
        '403':
          $ref: '#/components/schemas/Error'
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        

  /health:
    get:
      tags:
        - Health
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string

  /version:
    get:
      tags:
        - Health
      summary: Version information
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  version:
                    type: string

  /admin/users:
    post:
      tags:
        - Admin
      summary: Create new user (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - role
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
                role:
                  type: string
                  enum: [USER, ADMIN]
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Validation error or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (not ADMIN)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - Admin
      summary: List all users (admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (not ADMIN)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /admin/users/{userId}/role:
    put:
      tags:
        - Admin
      summary: Update user role (admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [USER, ADMIN]
      responses:
        '200':
          description: Role updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Validation error or user not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (not ADMIN)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'